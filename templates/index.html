<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>店铺推荐系统</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .description {
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .input-group label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .input-group input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(39, 174, 96, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(39, 174, 96, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #3498db, #2980b9);
            box-shadow: 0 4px 6px rgba(41, 128, 185, 0.2);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 6px 8px rgba(41, 128, 185, 0.3);
        }
        
        .user-profile {
            display: none;
            width: 100%;
            background: linear-gradient(to right, #f8f9fa, #ecf0f1);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }
        
        .profile-header {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .profile-header i {
            color: #3498db;
        }
        
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            padding: 15px 0;
        }
        
        .profile-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .profile-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .profile-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .recommendations {
            display: none;
            width: 100%;
        }
        
        .rec-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .rec-user {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .rec-type {
            font-size: 1.1rem;
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .rec-list {
            list-style-type: none;
        }
        
        .rec-item {
            background: white;
            border-left: 4px solid #2ecc71;
            padding: 15px 20px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s;
        }
        
        .rec-item:hover {
            transform: translateX(5px);
        }
        
        .rank-badge {
            width: 30px;
            height: 30px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .store-name {
            font-weight: 500;
            font-size: 1.1rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 15px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .error {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
        
        @media (max-width: 480px) {
            .container {
                width: 95%;
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .rec-item {
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏪 店铺推荐系统</h1>
        <p class="description">请输入您的用户ID，获取个性化店铺推荐</p>
        
        <div class="login-form">
            <div class="input-group">
                <label for="user_id">用户ID</label>
                <input type="text" id="user_id" placeholder="例如：123" value="12">
            </div>
            <button class="btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> 登录
            </button>
            <div class="error" id="error"></div>
        </div>

                <!-- 在用户登录表单后添加新用户注册表单 -->
        <div class="new-user-form" id="new-user-form" style="display: none;">
            <div class="section-header">
                <i class="fas fa-user-plus"></i> 新用户注册
                <p>请填写您的个人信息以便获得个性化推荐</p>
            </div>

            <div class="input-group">
                <label for="gender">性别</label>
                <select id="gender" class="form-input">
                    <option value="M">男</option>
                    <option value="F">女</option>
                </select>
            </div>

            <div class="input-group">
                <label for="age">年龄</label>
                <input type="number" id="age" class="form-input" placeholder="例如：25" min="18" max="100">
            </div>

            <div class="input-group">
                <label for="occupation">职业</label>
                <select id="occupation" class="form-input">
                    <option value="0">其他</option>
                    <option value="1">学术/教育</option>
                    <option value="2">艺术家</option>
                    <option value="3">文员/行政</option>
                    <option value="4">大学生</option>
                    <option value="5">客户服务</option>
                    <option value="6">医生/医疗</option>
                    <option value="7">管理</option>
                    <option value="8">农民</option>
                    <option value="9">家庭主妇</option>
                    <option value="10">学生</option>
                    <option value="11">律师</option>
                    <option value="12">程序员</option>
                    <option value="13">退休</option>
                    <option value="14">销售/营销</option>
                    <option value="15">科学家</option>
                    <option value="16">个体经营</option>
                    <option value="17">技术员</option>
                    <option value="18">工匠</option>
                    <option value="19">失业</option>
                </select>
            </div>

            <button class="btn" onclick="saveUserInfo()">
                <i class="fas fa-save"></i> 保存信息并获取推荐
            </button>
        </div>

        <div class="user-profile" id="user-profile">
            <div class="profile-header">
                <i class="fas fa-user-circle"></i> 用户信息
            </div>
            <div class="profile-grid">
                <div class="profile-item">
                    <div class="profile-label">用户ID</div>
                    <div class="profile-value" id="profile-id">12</div>
                </div>
                <div class="profile-item">
                    <div class="profile-label">性别</div>
                    <div class="profile-value" id="profile-gender">男</div>
                </div>
                <div class="profile-item">
                    <div class="profile-label">年龄</div>
                    <div class="profile-value" id="profile-age">28</div>
                </div>
                <div class="profile-item">
                    <div class="profile-label">职业</div>
                    <div class="profile-value" id="profile-occupation">程序员</div>
                </div>
            </div>

            <div class="input-group" style="margin-top: 20px;">
                <label for="algorithm">推荐算法</label>
                <select id="algorithm" class="form-input">
                    <option value="hybrid">混合推荐（默认）</option>
                    <option value="user_cf">基于用户的协同过滤 (UserCF)</option>
                    <option value="item_cf">基于店铺的协同过滤 (ItemCF)</option>
                    <option value="profile">用户画像推荐</option> <!-- 确保值为'profile' -->
                </select>
            </div>

            <button class="btn btn-secondary" onclick="getRecommendations()">
                <i class="fas fa-store"></i> 获取推荐
            </button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p class="loading-text">正在生成推荐，请稍候...</p>
        </div>

        <div class="recommendations" id="recommendations">
            <div class="rec-header">
                <div class="rec-user">用户 <span id="rec-user-id">12</span> 的推荐店铺</div>
                <div class="rec-type" id="rec-type">个性化推荐</div>
            </div>
            <ul class="rec-list" id="rec-list"></ul>
        </div>
    </div>

        <!-- 在用户登录表单后添加榜单区域 -->
    <div class="leaderboard-container" id="leaderboard-container">
        <div class="section-header">
            <i class="fas fa-trophy"></i> 热门榜单
            <p>无需登录即可查看热门店铺推荐</p>
        </div>

        <div class="leaderboard-buttons">
            <button class="leaderboard-btn" onclick="loadLeaderboard('top_popular')">
                <i class="fas fa-fire"></i> 最火爆TOP10
            </button>
            <button class="leaderboard-btn" onclick="loadLeaderboard('top_rated')">
                <i class="fas fa-star"></i> 评分最高TOP10
            </button>

        </div>

        <div class="leaderboard-results" id="leaderboard-results">
            <!-- 这里会动态加载榜单结果 -->
        </div>
    </div>

    <!-- 模态框，用于展示榜单详情 -->
    <div class="modal" id="leaderboard-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">热门店铺榜单</h2>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 这里会动态填充内容 -->
            </div>
        </div>
    </div>

    <style>
        .new-user-form {
        width: 100%;
        background: linear-gradient(to right, #f8f9fa, #ecf0f1);
        border-radius: 8px;
        padding: 25px;
        margin: 25px 0;
        border-left: 5px solid #3498db;
    }

    .form-input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e6ed;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-input:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

        .leaderboard-container {
            width: 100%;
            margin-top: 30px;
            margin-bottom: 30px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .section-header {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.6rem;
            color: #2c3e50;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .section-header i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #f39c12;
        }

        .section-header p {
            font-size: 1.1rem;
            color: #7f8c8d;
            max-width: 600px;
            margin-top: 10px;
        }

        .leaderboard-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .leaderboard-btn {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            box-shadow: 0 4px 6px rgba(41, 128, 185, 0.2);
        }

        .leaderboard-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(41, 128, 185, 0.3);
        }

        .leaderboard-btn:nth-child(1) {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }

        .leaderboard-btn:nth-child(2) {
            background: linear-gradient(to right, #f39c12, #d35400);
        }

        .leaderboard-btn:nth-child(3) {
            background: linear-gradient(to right, #2ecc71, #27ae60);
        }

        .leaderboard-results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .leaderboard-row {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
            transition: background 0.2s;
        }

        .leaderboard-row:hover {
            background: rgba(52, 152, 219, 0.05);
            cursor: pointer;
        }

        .rank-badge {
            width: 36px;
            height: 36px;
            background: #3498db;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .store-info {
            flex-grow: 1;
        }

        .store-name {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .store-genres {
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .store-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            margin-top: 8px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-value {
            font-weight: 600;
            color: #2c3e50;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalOpen 0.3s ease;
        }

        @keyframes modalOpen {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 20px 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: #2c3e50;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #7f8c8d;
            cursor: pointer;
            padding: 5px 10px;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-title {
            font-size: 1.3rem;
            color: #3498db;
            margin-bottom: 5px;
            text-align: center;
        }

        .modal-description {
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 25px;
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 50px 3fr repeat(3, 1fr);
            font-weight: bold;
            padding: 15px;
            background: #f1f2f6;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .leaderboard-item {
            display: grid;
            grid-template-columns: 50px 3fr repeat(3, 1fr);
            padding: 15px;
            border-bottom: 1px solid #f1f2f6;
        }

        .leaderboard-item:nth-child(even) {
            background: #f8f9fa;
        }

        .leaderboard-item:hover {
            background: #e3f2fd;
            cursor: pointer;
        }

        .rank-value {
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .leaderboard-buttons {
                flex-direction: column;
                align-items: center;
            }

            .leaderboard-btn {
                width: 100%;
                max-width: 300px;
            }

            .leaderboard-header,
            .leaderboard-item {
                grid-template-columns: 40px 2fr 1fr;
                grid-template-rows: auto auto;
            }

            .leaderboard-header > *:nth-child(4),
            .leaderboard-header > *:nth-child(5),
            .leaderboard-item > *:nth-child(4),
            .leaderboard-item > *:nth-child(5) {
                display: none;
            }

            .store-name-cell {
                grid-column: 2 / span 2;
            }

            .store-stats {
                grid-column: 2 / span 2;
                grid-row: 2;
                justify-content: space-between;
                margin-top: 10px;
            }
        }
    </style>

    <script>
        // 职业代码映射表
        const occupations = {
            0: "其他", 1: "学术/教育", 2: "艺术家", 3: "文员/行政",
            4: "大学生", 5: "客户服务", 6: "医生/医疗", 7: "管理",
            8: "农民", 9: "家庭主妇", 10: "学生", 11: "律师",
            12: "程序员", 13: "退休", 14: "销售/营销", 15: "科学家",
            16: "个体经营", 17: "技术员", 18: "工匠", 19: "失业"
        };

        function login() {
            const userId = document.getElementById('user_id').value;
            const errorDiv = document.getElementById('error');
            const userProfile = document.getElementById('user-profile');
            const loading = document.getElementById('loading');
            const recSection = document.getElementById('recommendations');

            // 隐藏之前的推荐结果
            recSection.style.display = 'none';

            if (!userId) {
                errorDiv.textContent = '请输入用户ID';
                return;
            }

            // 显示加载动画
            errorDiv.textContent = '';
            loading.style.display = 'block';
            userProfile.style.display = 'none';

            // 发送登录请求
            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `user_id=${userId}`
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('登录请求失败');
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }

                loading.style.display = 'none';

                // 更新用户信息显示
                document.getElementById('profile-id').textContent = data.user_id;

                if (data.user_info) {
                    // 更新用户资料
                    document.getElementById('profile-gender').textContent =
                        data.user_info.gender === 'M' ? '男' : '女';
                    document.getElementById('profile-age').textContent =
                        data.user_info.age || '未知';
                    document.getElementById('profile-occupation').textContent =
                        occupations[data.user_info.occupation] || '未知';
                } else {
                    // 默认显示
                    document.getElementById('profile-gender').textContent = '男';
                    document.getElementById('profile-age').textContent = '28';
                    document.getElementById('profile-occupation').textContent = '程序员';
                }

                // 显示用户信息区域
                userProfile.style.display = 'block';

                if (data.is_new_user) {
                    // 显示新用户注册表单
                    document.getElementById('new-user-form').style.display = 'block';
                    document.getElementById('user-profile').style.display = 'none';
                } else {
                    // 显示用户信息区域
                    document.getElementById('user-profile').style.display = 'block';
                    document.getElementById('new-user-form').style.display = 'none';
                }

            })
            .catch(error => {
                loading.style.display = 'none';
                errorDiv.textContent = error.message || '登录失败，请稍后再试';
                console.error('登录错误:', error);
            });
        }

        function saveUserInfo() {
            const userId = document.getElementById('user_id').value;
            const gender = document.getElementById('gender').value;
            const age = document.getElementById('age').value;
            const occupation = document.getElementById('occupation').value;
            const errorDiv = document.getElementById('error');

            if (!age) {
                errorDiv.textContent = '请填写所有必填字段';
                return;
            }

            // 发送用户信息到后端
            fetch('/save_user_info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userId,
                    gender: gender,
                    age: age,
                    occupation: occupation,
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 更新用户信息显示
                    document.getElementById('profile-gender').textContent =
                        data.user_info.gender === 'M' ? '男' : '女';
                    document.getElementById('profile-age').textContent =
                        data.user_info.age;
                    document.getElementById('profile-occupation').textContent =
                        occupations[data.user_info.occupation] || '未知';

                    // 显示用户信息区域
                    document.getElementById('user-profile').style.display = 'block';
                    document.getElementById('new-user-form').style.display = 'none';

                    // 自动获取推荐
                    getRecommendations();
                } else {
                    errorDiv.textContent = data.error || '保存用户信息失败';
                }
            })
            .catch(error => {
                errorDiv.textContent = '保存用户信息失败，请稍后再试';
                console.error('保存错误:', error);
            });
        }

        function getRecommendations() {
    const userId = document.getElementById('user_id').value;
    const algorithm = document.getElementById('algorithm').value; // 获取选择的算法
    const errorDiv = document.getElementById('error');
    const loading = document.getElementById('loading');
    const recSection = document.getElementById('recommendations');
    const recList = document.getElementById('rec-list');

    // 显示加载动画
    errorDiv.textContent = '';
    loading.style.display = 'block';
    recSection.style.display = 'none';

    // 修复点：发送带算法参数的请求
    fetch(`/recommend?algorithm=${algorithm}`) // 这里添加算法参数
    .then(response => {
        if (!response.ok) {
            throw new Error('推荐请求失败');
        }
        return response.json();
    })
    .then(data => {
        loading.style.display = 'none';

        if (data.error) {
            throw new Error(data.error);
        }

        // 更新用户ID显示
        document.getElementById('rec-user-id').textContent = data.user_id;

        // 更新推荐类型
        document.getElementById('rec-type').textContent = data.rec_type || '个性化推荐';

        // 更新用户信息（确保一致）
        if (data.user_info) {
            document.getElementById('profile-gender').textContent =
                data.user_info.gender === 'M' ? '男' : '女';
            document.getElementById('profile-age').textContent =
                data.user_info.age || '未知';
            document.getElementById('profile-occupation').textContent =
                occupations[data.user_info.occupation] || '未知';
        }

        // 清除旧列表
        recList.innerHTML = '';

        // 添加推荐项目
        data.recommendations.forEach(item => {
            const li = document.createElement('li');
            li.className = 'rec-item';

            li.innerHTML = `
                <div class="rank-badge">${item.rank}</div>
                <div class="store-name">${item.name}</div>
            `;

            recList.appendChild(li);
        });

        // 显示推荐结果
        recSection.style.display = 'block';
    })
    .catch(error => {
        loading.style.display = 'none';
        errorDiv.textContent = error.message || '获取推荐失败，请稍后再试';
        console.error('推荐错误:', error);
    });
}

        // 支持按Enter键登录
        document.getElementById('user_id').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // 页面加载时隐藏推荐部分
        window.onload = function() {
            document.getElementById('user-profile').style.display = 'none';
            document.getElementById('recommendations').style.display = 'none';
        };

        // 添加加载榜单的函数
        function loadLeaderboard(type) {
            const resultsDiv = document.getElementById('leaderboard-results');
            const errorDiv = document.getElementById('error');
            const modal = document.getElementById('leaderboard-modal');
            const modalBody = document.getElementById('modal-body');
            const modalTitle = document.getElementById('modal-title');

            // 显示加载状态
            resultsDiv.innerHTML = '<div class="loading-text"><i class="fas fa-spinner fa-spin"></i> 正在加载榜单数据...</div>';
            errorDiv.textContent = '';

            // 确定API端点
            let endpoint;
            switch(type) {
                case 'top_popular':
                    endpoint = '/top_popular';
                    break;
                case 'top_rated':
                    endpoint = '/top_rated';
                    break;
                case 'top_value':
                    endpoint = '/top_value';
                    break;
                default:
                    resultsDiv.innerHTML = '<div class="error">未知榜单类型</div>';
                    return;
            }

            // 获取榜单数据
            fetch(endpoint)
                .then(response => response.json())
                .then(data => {
                    if (!data.stores || data.stores.length === 0) {
                        resultsDiv.innerHTML = '<div class="error">暂无榜单数据</div>';
                        return;
                    }

                    // 更新标题
                    modalTitle.textContent = data.title;

                    // 清空并填充模态框内容
                    modalBody.innerHTML = `
                        <div class="modal-title">${data.title}</div>
                        <p class="modal-description">${data.description}</p>
                        <div class="leaderboard-header">
                            <div>排名</div>
                            <div>店铺名称</div>
                            <div>评论数</div>
                            <div>评分</div>
                            <div>人均消费</div>
                        </div>
                    `;

                    // 添加每家店铺
                    data.stores.forEach((store, index) => {
                        const rank = index + 1;
                        const rankCell = `<div class="rank-value">${rank}</div>`;
                        const nameCell = `<div class="store-name-cell">
                            <div class="store-name">${store.title}</div>
                            <div class="store-genres">${store.genres || '无分类'}</div>
                        </div>`;

                        // 为不同榜单添加特定数据
                        let numCmtCell = `<div class="stat-item">${store.num_cmt || 0}</div>`;
                        let ratingCell = `<div class="stat-item">${store.avg_rating?.toFixed(1) || '无'}</div>`;
                        let perConCell = `<div class="stat-item">${store.per_con ? '¥' + store.per_con.toFixed(2) : '无数据'}</div>`;

                        // 性价比榜单有特殊字段
                        if (type === 'top_value') {
                            const valueRatio = store.per_con?.toFixed(3) || '无';
                            numCmtCell = `<div class="stat-item">${store.num_cmt || 0}</div>`;
                            ratingCell = `<div class="stat-item">${store.avg_rating?.toFixed(1) || '无'}</div>`;
                            perConCell = `<div class="stat-item">${store.per_con ? '¥' + store.per_con.toFixed(2) : '无数据'}</div>`;
                        }

                        // 创建一行
                        const row = document.createElement('div');
                        row.className = 'leaderboard-item';
                        row.innerHTML = `
                            ${rankCell}
                            ${nameCell}
                            ${numCmtCell}
                            ${ratingCell}
                            ${perConCell}
                        `;

                        modalBody.appendChild(row);
                    });

                    // 显示模态框
                    modal.style.display = 'flex';
                })
                .catch(error => {
                    resultsDiv.innerHTML = '<div class="error">加载榜单失败，请稍后再试</div>';
                    console.error('加载榜单错误:', error);
                });
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('leaderboard-modal').style.display = 'none';
        }

        // 点击模态框外部关闭
        window.addEventListener('click', (event) => {
            const modal = document.getElementById('leaderboard-modal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // 默认加载最火爆榜单
        document.addEventListener('DOMContentLoaded', function() {
            loadLeaderboard('top_popular');
        });
    </script>
</body>
</html>